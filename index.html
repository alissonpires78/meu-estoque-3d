<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="theme-color" content="#0f172a" />
    <meta name="description" content="Sistema de gerenciamento para impressão 3D FDM" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="PrintManager 3D" />
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json" />
    
    <!-- Icons -->
    <link rel="icon" type="image/svg+xml" href="./favicon.svg" />
    <link rel="apple-touch-icon" href="/icon-192x192.png" />
    
    <!-- Preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    
    <title>PrintManager 3D</title>
    
    <style>
      /* Critical CSS for loading state */
      body {
        margin: 0;
        padding: 0;
        background-color: #0f172a;
        font-family: system-ui, -apple-system, sans-serif;
      }
      #root {
        min-height: 100vh;
      }
      .loading-screen {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      }
      .loading-spinner {
        width: 48px;
        height: 48px;
        border: 3px solid #334155;
        border-top-color: #6366f1;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
    </style>
    <script type="module" crossorigin src="./assets/index-CO4xKqc3.js"></script>
    <link rel="stylesheet" crossorigin href="./assets/index-DSJbRdbP.css">
    <script>
      // Abre a página de impressão de etiqueta com dados do filamento (chamado pelo app ou por interceptação de clique)
      window.openEtiquetaFilamento = function(filament) {
        if (!filament || !filament.qrCode) return;
        var q = [];
        q.push('qr=' + encodeURIComponent(filament.qrCode));
        if (filament.name) q.push('name=' + encodeURIComponent(filament.name));
        if (filament.color) q.push('color=' + encodeURIComponent(filament.color));
        if (filament.material) q.push('material=' + encodeURIComponent(filament.material));
        if (filament.weightRemaining != null) q.push('weightRemaining=' + encodeURIComponent(String(filament.weightRemaining)));
        if (filament.weightTotal != null) q.push('weightTotal=' + encodeURIComponent(String(filament.weightTotal)));
        window.open('./etiqueta.html?' + q.join('&'), '_blank', 'noopener');
      };
      // Interceptar clique em "Imprimir etiqueta" e extrair dados da linha da tabela (fallback quando o app não chama openEtiquetaFilamento)
      document.addEventListener('click', function(ev) {
        var target = ev.target;
        while (target && target !== document.body) {
          var text = (target.textContent || '').trim();
          if (text === 'Imprimir etiqueta') {
            var row = target.closest ? (target.closest('tr') || target.closest('[role="row"]')) : null;
            if (!row) {
              row = target;
              while (row && row.tagName !== 'TR' && row.getAttribute && row.getAttribute('role') !== 'row') row = row.parentElement;
            }
            if (!row) return;
            var cells = row.cells ? [].slice.call(row.cells) : (row.querySelectorAll ? [].slice.call(row.querySelectorAll('[role="cell"], td')) : []);
            var texts = cells.map(function(c) { return (c.textContent || '').trim(); }).filter(Boolean);
            var qrCode = texts.find(function(t) { return t.length >= 5 && /^[A-Za-z0-9\-_.:\/]+$/.test(t); }) || texts[0] || '';
            if (!qrCode) return;
            ev.preventDefault();
            ev.stopPropagation();
            window.openEtiquetaFilamento({
              qrCode: qrCode,
              name: texts[1] || '',
              color: texts[2] || '',
              material: texts[3] || '',
              weightRemaining: texts[4] || null,
              weightTotal: texts[5] || null
            });
            return;
          }
          target = target.parentElement;
        }
      }, true);
    </script>
  </head>
  <body>
    <div id="root">
      <div class="loading-screen">
        <div class="loading-spinner"></div>
      </div>
    </div>
  </body>
</html>
